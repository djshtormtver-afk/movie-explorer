<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Explorer Pro - –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤</title>
    <style>
        :root {
            --primary: #e50914;
            --secondary: #221f1f;
            --accent: #ffd700;
            --text-light: #ffffff;
            --text-dark: #221f1f;
            --bg-dark: #141414;
            --bg-darker: #0a0a0a;
            --border-color: #404040;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-darker) 0%, var(--bg-dark) 100%);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
        }
        header {
            background: linear-gradient(180deg, rgba(20, 20, 20, 0.95) 0%, rgba(20, 20, 20, 0.8) 100%);
            border-bottom: 3px solid var(--primary);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(229, 9, 20, 0.2);
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .search-bar {
            flex: 1;
            margin: 0 30px;
            position: relative;
        }
        .search-bar input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-light);
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.12);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        .filters-section {
            background: rgba(34, 31, 31, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .filter-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent);
        }
        .filter-group select,
        .filter-group input {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: rgba(20, 20, 20, 0.7);
            color: var(--text-light);
        }
        .search-btn {
            padding: 10px 24px;
            background: var(--primary);
            border: none;
            border-radius: 6px;
            color: var(--text-light);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(229, 9, 20, 0.4);
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: var(--accent);
        }
        .error {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.5);
            color: #ff6b6b;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        .movie-card {
            background: rgba(34, 31, 31, 0.7);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .movie-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
        }
        .movie-poster {
            width: 100%;
            height: 400px;
            background: #222;
            position: relative;
        }
        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .rating-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 12px;
        }
        .movie-info {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .movie-title {
            font-size: 16px;
            font-weight: bold;
        }
        .movie-year {
            font-size: 14px;
            color: var(--accent);
        }
        .movie-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .genre-tag {
            font-size: 11px;
            background: rgba(229, 9, 20, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
        }
        .movie-buttons {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        .btn {
            flex: 1;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
        .btn-primary {
            background: var(--primary);
            border-color: var(--primary);
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
        }
        .pagination button {
            padding: 8px 16px;
            background: #222;
            border: 1px solid var(--border-color);
            color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .pagination button:hover {
            background: var(--primary);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--bg-dark);
            border: 2px solid var(--primary);
            border-radius: 12px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: white;
        }
        .movie-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }
        .detail-poster img {
            width: 100%;
            border-radius: 8px;
        }
        .detail-info h2 { color: var(--accent); margin-bottom: 15px; }
        .detail-label { font-weight: bold; color: var(--accent); margin-top: 10px; font-size: 12px; text-transform: uppercase; }
        .detail-value { margin-bottom: 10px; }
        .trailer-container { margin-top: 30px; border-top: 1px solid var(--border-color); padding-top: 20px; }
        .trailer-player { width: 100%; aspect-ratio: 16/9; border: none; border-radius: 8px; }
        @media (max-width: 768px) {
            .movie-details { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">üé¨ MOVIE EXPLORER PRO</div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤, –∞–∫—Ç—ë—Ä–æ–≤...">
            </div>
        </div>
    </header>

    <div class="container">
        <div class="filters-section">
            <div class="filter-group">
                <label for="genreFilter">–ñ–∞–Ω—Ä</label>
                <select id="genreFilter">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="countryFilter">–°—Ç—Ä–∞–Ω–∞</label>
                <select id="countryFilter">
                    <option value="">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</option>
                    <option value="RU">–†–æ—Å—Å–∏—è</option>
                    <option value="US">–°–®–ê</option>
                    <option value="GB">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</option>
                    <option value="FR">–§—Ä–∞–Ω—Ü–∏—è</option>
                    <option value="DE">–ì–µ—Ä–º–∞–Ω–∏—è</option>
                    <option value="KR">–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="yearFilter">–ì–æ–¥</label>
                <input type="number" id="yearFilter" placeholder="2024" min="1900" max="2026">
            </div>
            <div class="filter-group">
                <label for="ratingFilter">–†–µ–π—Ç–∏–Ω–≥ –æ—Ç</label>
                <input type="number" id="ratingFilter" placeholder="0-10" min="0" max="10" step="0.1">
            </div>
            <div class="filter-group">
                <label for="sortFilter">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                <select id="sortFilter">
                    <option value="popularity.desc">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
                    <option value="vote_average.desc">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                    <option value="release_date.desc">–ü–æ –¥–∞—Ç–µ –≤—ã—Ö–æ–¥–∞</option>
                </select>
            </div>
            <button class="search-btn" onclick="searchMovies()">–ü–æ–∏—Å–∫</button>
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>
        <div id="loadingSpinner" class="loading" style="display: none;">–ó–∞–≥—Ä—É–∑–∫–∞</div>
        <div class="movies-grid" id="moviesGrid"></div>
        <div class="pagination" id="pagination"></div>
    </div>

    <div class="modal" id="trailerModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div class="movie-details">
                <div class="detail-poster">
                    <img id="modalPoster" src="" alt="Poster">
                </div>
                <div class="detail-info">
                    <h2 id="modalTitle"></h2>
                    <div class="detail-label">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</div>
                    <div class="detail-value" id="modalYear"></div>
                    <div class="detail-label">–†–µ–π—Ç–∏–Ω–≥</div>
                    <div class="detail-value" id="modalRating"></div>
                    <div class="detail-label">–ñ–∞–Ω—Ä—ã</div>
                    <div class="detail-value" id="modalGenres"></div>
                    <div class="detail-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                    <p id="modalDescription"></p>
                </div>
            </div>
            <div class="trailer-container" id="trailerContainer" style="display: none;">
                <h3>–¢—Ä–µ–π–ª–µ—Ä</h3>
                <iframe class="trailer-player" id="trailerFrame" src="" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const TMDB_BASE_URL = "https://tmdb-api-proxy-production-2c93.up.railway.app";
        const YOUTUBE_API_KEY = "AIzaSyDcQoSQ1CnOVJwpm37cPvmraK1Xmsm2sT4";

        let currentPage = 1;
        let totalPages = 1;
        let genres = [];

        // Elements
        const searchInput = document.getElementById("searchInput");
        const genreFilter = document.getElementById("genreFilter");
        const countryFilter = document.getElementById("countryFilter");
        const yearFilter = document.getElementById("yearFilter");
        const ratingFilter = document.getElementById("ratingFilter");
        const sortFilter = document.getElementById("sortFilter");
        const moviesGrid = document.getElementById("moviesGrid");
        const pagination = document.getElementById("pagination");
        const loadingSpinner = document.getElementById("loadingSpinner");
        const errorMessage = document.getElementById("errorMessage");
        const trailerModal = document.getElementById("trailerModal");

        // Initialize
        async function init() {
            try {
                await loadGenres();
                await searchMovies();
            } catch (err) {
                showError("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: " + err.message);
            }
        }

        async function loadGenres() {
            try {
                const res = await fetch(`${TMDB_BASE_URL}/api/genres?language=ru-RU`);
                const data = await res.json();
                genres = data.genres || [];
                genres.forEach(g => {
                    const opt = document.createElement("option");
                    opt.value = g.id;
                    opt.textContent = g.name;
                    genreFilter.appendChild(opt);
                });
            } catch (err) {
                console.error("Genres error:", err);
            }
        }

        async function searchMovies(page = 1) {
            try {
                loadingSpinner.style.display = "block";
                errorMessage.style.display = "none";
                currentPage = page;

                const query = searchInput.value.trim();
                let url = query 
                    ? `${TMDB_BASE_URL}/api/search?query=${encodeURIComponent(query)}&page=${page}&language=ru-RU`
                    : `${TMDB_BASE_URL}/api/discover?page=${page}&language=ru-RU`;

                if (!query) {
                    if (genreFilter.value) url += `&with_genres=${genreFilter.value}`;
                    if (countryFilter.value) url += `&with_origin_country=${countryFilter.value}`;
                    if (yearFilter.value) url += `&primary_release_year=${yearFilter.value}`;
                    if (ratingFilter.value) url += `&vote_average.gte=${ratingFilter.value}`;
                    if (sortFilter.value) url += `&sort_by=${sortFilter.value}`;
                }

                const res = await fetch(url);
                const data = await res.json();

                if (!data.results || data.results.length === 0) {
                    moviesGrid.innerHTML = "<p style='text-align:center; width:100%; grid-column: 1/-1;'>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>";
                    pagination.innerHTML = "";
                } else {
                    totalPages = data.total_pages;
                    displayMovies(data.results);
                    displayPagination(data.total_pages);
                }
                loadingSpinner.style.display = "none";
            } catch (err) {
                showError("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: " + err.message);
                loadingSpinner.style.display = "none";
            }
        }

        function displayMovies(movies) {
            moviesGrid.innerHTML = "";
            movies.forEach(movie => {
                const card = document.createElement("div");
                card.className = "movie-card";
                const poster = movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : "";
                const movieGenres = movie.genre_ids.map(id => {
                    const g = genres.find(x => x.id === id);
                    return g ? g.name : null;
                }).filter(Boolean).slice(0, 2).join(", ");

                card.innerHTML = `
                    <div class="movie-poster">
                        ${poster ? `<img src="${poster}" alt="${movie.title}">` : `<div style="padding:20px; text-align:center;">–ù–µ—Ç —Ñ–æ—Ç–æ</div>`}
                        <div class="rating-badge">‚òÖ ${movie.vote_average.toFixed(1)}</div>
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-year">${(movie.release_date || "").split("-")[0] || "N/A"}</div>
                        <div class="movie-genres">${movieGenres ? `<span class="genre-tag">${movieGenres}</span>` : ""}</div>
                        <div class="movie-buttons">
                            <button class="btn btn-primary" onclick="showDetails(${movie.id})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                        </div>
                    </div>
                `;
                card.onclick = (e) => {
                    if (e.target.tagName !== 'BUTTON') showDetails(movie.id);
                };
                moviesGrid.appendChild(card);
            });
        }

        function displayPagination(total) {
            pagination.innerHTML = "";
            const maxPages = Math.min(total, 500);
            
            if (currentPage > 1) {
                const btn = document.createElement("button");
                btn.textContent = "–ù–∞–∑–∞–¥";
                btn.onclick = () => searchMovies(currentPage - 1);
                pagination.appendChild(btn);
            }

            const info = document.createElement("span");
            info.textContent = ` –°—Ç—Ä ${currentPage} –∏–∑ ${maxPages} `;
            info.style.alignSelf = "center";
            pagination.appendChild(info);

            if (currentPage < maxPages) {
                const btn = document.createElement("button");
                btn.textContent = "–í–ø–µ—Ä–µ–¥";
                btn.onclick = () => searchMovies(currentPage + 1);
                pagination.appendChild(btn);
            }
        }

        async function showDetails(id) {
            try {
                loadingSpinner.style.display = "block";
                const [details, videos] = await Promise.all([
                    fetch(`${TMDB_BASE_URL}/api/movie/${id}?language=ru-RU`).then(r => r.json()),
                    fetch(`${TMDB_BASE_URL}/api/movie/${id}/videos?language=ru-RU`).then(r => r.json())
                ]);

                document.getElementById("modalTitle").textContent = details.title;
                document.getElementById("modalPoster").src = details.poster_path ? `https://image.tmdb.org/t/p/w500${details.poster_path}` : "";
                document.getElementById("modalYear").textContent = details.release_date || "N/A";
                document.getElementById("modalRating").textContent = `‚òÖ ${details.vote_average.toFixed(1)}`;
                document.getElementById("modalGenres").textContent = details.genres.map(g => g.name).join(", ");
                document.getElementById("modalDescription").textContent = details.overview || "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç";

                const trailer = (videos.results || []).find(v => v.type === "Trailer" && v.site === "YouTube");
                const trailerContainer = document.getElementById("trailerContainer");
                const trailerFrame = document.getElementById("trailerFrame");

                if (trailer) {
                    trailerContainer.style.display = "block";
                    trailerFrame.src = `https://www.youtube.com/embed/${trailer.key}`;
                } else {
                    trailerContainer.style.display = "none";
                    trailerFrame.src = "";
                }

                trailerModal.classList.add("active");
                loadingSpinner.style.display = "none";
            } catch (err) {
                showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π: " + err.message);
                loadingSpinner.style.display = "none";
            }
        }

        function closeModal() {
            trailerModal.classList.remove("active");
            document.getElementById("trailerFrame").src = "";
        }

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.style.display = "block";
            window.scrollTo(0, 0);
        }

        searchInput.onkeypress = (e) => { if (e.key === "Enter") searchMovies(1); };
        window.onclick = (e) => { if (e.target === trailerModal) closeModal(); };
        
        init();
    </script>
</body>
</html>
